---
layout: post
lang: en
ghcode: LSTMForecastSells
lang-ref: lstmvendas1c
title: "Forecasting Sales using LSTM Neural Networks"
date: 2019-12-19 12:00:00 -0300
description: Forecasting Sales for a big electronic store using Long Short-Term Memory Recurrent Neural Networks.
img: graficosvendas1c_cover.png # Add image post (optional)
fig-caption: # Add figcaption (optional)
tags: [Artificial Intelligence,Data Analysis,Matlab]
permalink: lstm-forecast-1c
---
## Introduction
It was provided by [1C Company](http://www.1c.com/) a time-series dataset consisting of daily sales data for a data science competition hold by [Kaggle](https://www.kaggle.com/). The goal was to predict the company's next month profit. Overall, **2 million sales** are used for calculations made using Matlab as main language/software for analysis and prediction.

## Database
The database used in this project consists of a daily sales record of a chain of stores focused on the technology and entertainment market. The sales table, provided in ```.cvs``` format, contains information on the product's date of sale, its registration code, quantity and its profits from sales in rubles (Russian currency); all records are within the range of 01/01/2013 and 09/30/2014 and your data does not need to go through *data cleaning*.

![A sample from the database.]({{site.baseurl}}/assets/img/1CPS-exemplo.png)

## Preliminary Data Analysis
### Product Review
We start by segmenting the sales data so that each product sold is analyzed isolated. From segmentation, we can analyze which are the best selling products using criteria such as quantity and value collected.

![The top 10 most profitable products between the 21-month known data range.]({{site.baseurl}}/assets/img/graficosvendas1c_top10-profits.png)

Considering the figure above, it is observed that consoles and games build most part of the ranking but it would be necessary to observe a large amount of data to say which of the niches gives the highest return to the company. Therefore, this kind of analysis is made using a slightly different algorithm.


### Product Type Analysis
The database makes associates each product (```item_id```) to the category that best represents it (```item_categories```). To connect this data you would need to cross data from three ```.cvs``` files to get one of **84 categories** using the```item_id``` of each product as an input. The categories are written in Russian in the original database and were translated from Russian by [David Eargle](https://daveeargle.com/). The results obtained are presented below.

![The top 10 most profitable categories of products between the 21-month known data range.]({{site.baseurl}}/assets/img/graficosvendas1c_top10-profits-categories.png)

The analysis tells us that **PS3 games were the most profitable products for the company** (mind the sales occurred between 2013 and 2014), **summing up to 15% of the total profit** generated in sales. The figure below shows the profits of all 84 categories.

![Profits from each category of products; values smaller than 2Mâ‚½ are not shown.]({{site.baseurl}}/assets/img/graficosvendas1c_allprofits.png)

Each product or category has a different selling behavior within the time frame contained in the database. In the figure below we present all the time-distributed sales of the *PS3 Games* category (the most lucrative category) over the database's days range to analyze its behavior.

![Income over time from PS3 Games' sales. The first image represents income over time for each day while the second one shows the accumulative income over time.]({{site.baseurl}}/assets/img/graficosvendas1c_profit-from-toplucrative.png)

#### What does it tell us?
The sales revenue analysis could show the marketing team which of the most profitable categories can be exploited by the company's advertising team to increase the total income from sales. Also, eight product categories had a total of **zero sales** during the period analyzed, which means there is an allocation of human and financial resources as well as storage occupation that can be reversed without interfering with store sales rate. 

## Sales Forecast from Database
### Model Choice
To make sales forecasts, it is common practice to perform a linear regression on the accumulated revenue over time. The Linear Regression model creates a straight line with the best configuration to represent all revenue generated by sales over time with the smallest error associated with adjusting points.

After some research, it was decided to compare this simpler and more traditional method, the Linear Regression, with an artificial intelligence regression, in this case, an *LSTM* (Short Long-Term Memory). Before applying it to find the final forecast, both the Linear Regression and LSTM methods were tested on all 84 item categories; Out of the 638 days recorded in the database, the first 607 were used to train the models and the last 31 days were used to validate them; This means that models will try to forecast sales in the last 31 known days based on the 607 other days. The image below shows the mean square root error (MSRE) associated with each model applied to the 84 categories. **MSRE values of LSTM models were lower than linear models in more than 83% of categories in the validation test**, so this model is chosen to forecast sales. 

![MSRE from validation tests on both Linear Regression and LSTM models. Only the 44 greatest values from the Linear models are shown, with its respective MSRE from the LSTM model on the other side of the y-axis.]({{site.baseurl}}/assets/img/graficosvendas1c_MSRE-tests.png)

### Forecast by Category
The configuration chosen to the *LSTM* neural network is the same for all 84 categories: five consecutive days are used as income to the NN to forecast sales on the sixth. For each category, its respective set of 638 known sales days is used to power the neural network in its training 180 times before making any predictions.

In the figure below we show the prediction made for the most lucrative category from the database. The green color shows the last 31 days of sales in the database and the red sales forecast by the neural network.

![PS3 Games profit forecast for October/2014 based upon the sales revenue within January/2013 and September/2014.]({{site.baseurl}}/assets/img/graficosvendas1c_ps3games-profitforecast.png)


### Final Sales Forecast Result
The prediction process took a few hours on my Desktop: for each of the 84 categories, a neural network is created to be trained with ```638 * 180 = 114840``` days of sales. After all training repetitions, **more than 360 million sales records are used for training LSTM Networks** to obtain the final forecast for October 2014, shown in the figure below. Mind the increase of the income, which is 37% greater than its previous month.

![Profit from the last month of registered sales vs. the forecast to the next month's income.]({{site.baseurl}}/assets/img/graficosvendas1c_profitresults.png)